# Ant
# Build your Java projects and run tests with Apache Ant.
# Add steps that save build artifacts and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- master
  
pool:
  name: Default

steps:
- script: |
    echo add_class_folder;
    mkdir ./build/WEB-INF/classes
  displayName: 'Add class folder'
- task: Ant@1
  inputs:
    buildFile: 'build.xml'
    options: 
    targets: 'build'
    publishJUnitResults: true
    testResultsFiles: '**/TEST-*.xml'
    javaHomeOption: 'JDKVersion'
  displayName: 'Ant Build'
- script: |
    echo deepdive_scan
    wget https://discotek.ca/download?file=discotek.deepdive-1.5.11-beta.zip -o deepdive.zip
    unzip deepdive.zip
  displayName: 'Deepdive - SAST'
# steps:
# - script: |
# echo $PATH
#    export CODE_DIR=${PWD}
#    cd $CODE_DIR
#    docker run -e CODE_DIR -v ${PWD}:${PWD}  scanmycode/scanmycode3-ce:worker-cli /bin/sh -c 'cd $CODE_DIR && checkmate init'
#    docker run -e CODE_DIR -v ${PWD}:${PWD}  scanmycode/scanmycode3-ce:worker-cli /bin/sh -c 'cd $CODE_DIR && checkmate git init'
#    docker run -e CODE_DIR -v ${PWD}:${PWD}  scanmycode/scanmycode3-ce:worker-cli /bin/sh -c 'cd $CODE_DIR && checkmate git analyze --branch `git rev-parse --abbrev-ref HEAD`'
 #   docker run -e CODE_DIR -v ${PWD}:${PWD}  scanmycode/scanmycode3-ce:worker-cli /bin/sh -c 'cd $CODE_DIR && checkmate issues html'
#  displayName: 'Betterscan - SAST'

